#!/usr/bin/env bash

echo -n "Trying to access http://${OC_URL}/status.php"
STARTED=$(date +%s)
TIMEOUT=${TIMEOUT:-3600}

while [ $(( $(date +%s) - ${TIMEOUT} )) -lt $STARTED ]
do
    if [[ $(curl --write-out %{http_code} --silent --output /dev/null http://$OC_URL/status.php) == "200" ]]
    then
        break
    else
        echo -n "."
        sleep 1
    fi
done

if [ $(( $(date +%s) - ${TIMEOUT} )) -ge $STARTED ]
then
    echo "failed!"
    exit 1
fi

echo "done!"
exec /smashbox/bin/smash $*
